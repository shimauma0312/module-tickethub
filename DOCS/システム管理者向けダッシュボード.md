# システム管理者向けダッシュボード機能説明書

## 1. 概要

TicketHubの管理者ダッシュボードは、システム管理者がシステム全体の状態を監視し、管理するための機能。
ユーザー管理、システム設定、アクティビティログ、システムメトリクス、データバックアップなど、管理者に必要な機能を集約したインターフェースを提供します。

## 2. 主要機能

### 2.1 ユーザー管理機能

管理者はシステム内のすべてのユーザーアカウントを管理できます。

#### 主な機能

- **ユーザー一覧表示**: システム内のすべてのユーザーを一覧表示（ページング対応）
- **ユーザー情報詳細表示**: 特定のユーザーの詳細情報を表示
- **ユーザー権限管理**: 管理者権限の付与・剥奪
- **アカウント状態管理**: ユーザーアカウントのアクティブ化・非アクティブ化
- **ユーザー検索・フィルタリング**: 名前、ステータス、アクティビティなどによるフィルタリング

#### 実装ファイル
- `api/admin_handler.go`: ユーザー管理APIエンドポイント処理
- `repositories/gorm/user_repository.go`: ユーザー情報の永続化処理

### 2.2 システム設定管理

システム全体の設定を管理するための機能を提供します。

#### 主な機能

- **システム設定表示**: 現在のシステム設定を表示
- **システム設定更新**: 設定値の更新（サイト名、ロゴ、メール設定、認証設定など）
- **デフォルト設定管理**: 新規ユーザー向けのデフォルト設定管理
- **機能のオン/オフ切り替え**: 特定の機能の有効/無効設定

#### 実装ファイル
- `api/admin_handler.go`: システム設定管理APIエンドポイント処理
- `repositories/gorm/system_settings_repository.go`: システム設定の永続化処理
- `models/system_settings.go`: システム設定のデータモデル

### 2.3 アクティビティログ管理

システム内で発生したアクティビティを記録・閲覧するための機能を提供します。

#### 主な機能

- **アクティビティログ一覧表示**: システムでのアクティビティログを一覧表示（ページング対応）
- **ログフィルタリング**: ユーザー、アクション種別、リソースタイプなどによるフィルタリング
- **期間指定検索**: 特定期間内のアクティビティを検索
- **詳細表示**: 特定のアクティビティの詳細情報を表示
- **ログエクスポート**: 監査目的などのためのログエクスポート機能

#### 実装ファイル
- `api/admin_handler.go`: アクティビティログ管理APIエンドポイント処理
- `services/activity_log_service.go`: アクティビティログサービスの実装
- `repositories/gorm/activity_log_repository.go`: アクティビティログの永続化処理
- `models/activity_log.go`: アクティビティログのデータモデル

### 2.4 システムメトリクスダッシュボード

システムのパフォーマンスや利用状況を可視化するためのメトリクスダッシュボードを提供します。

#### 主な機能

- **ユーザーメトリクス**: 総ユーザー数、アクティブユーザー数、新規ユーザー登録推移など
- **コンテンツメトリクス**: Issue数、Discussion数、コメント数、オープン/クローズ状態の割合など
- **システムリソースメトリクス**: メモリ使用量、CPU使用率、ディスク使用量、データベース接続数など
- **パフォーマンスメトリクス**: レスポンスタイム、スループット、エラー率など
- **トレンド分析**: 時系列でのメトリクス変化のグラフ表示

#### 実装ファイル
- `api/admin_handler.go`: システムメトリクス取得APIエンドポイント処理
- `services/system_metrics_service.go`: メトリクス収集サービスの実装
- `models/system_metrics.go`: システムメトリクスのデータモデル

### 2.5 データバックアップ・リストア機能

システムデータのバックアップと復元を管理するための機能を提供します。

#### 主な機能

- **バックアップ作成**: システムデータの手動バックアップ作成
- **バックアップ一覧表示**: 作成済みバックアップの一覧表示
- **バックアップ詳細表示**: バックアップの詳細情報（作成日時、サイズ、説明など）の表示
- **バックアップからのリストア**: 選択したバックアップからのシステム復元
- **バックアップ削除**: 不要になったバックアップの削除
- **自動バックアップスケジュール設定**: 定期的な自動バックアップのスケジュール設定

#### 実装ファイル
- `api/admin_handler.go`: バックアップ管理APIエンドポイント処理
- `services/backup_service.go`: バックアップサービスの実装
- `repositories/gorm/backup_repository.go`: バックアップ情報の永続化処理
- `models/backup.go`: バックアップのデータモデル

### 2.6 リポジトリ管理機能

TicketHub内のリポジトリを管理するための機能を提供します。

#### 主な機能

- **リポジトリ一覧表示**: システム内のリポジトリを一覧表示
- **リポジトリ作成**: 新規リポジトリの作成
- **リポジトリ設定更新**: 既存のリポジトリの設定更新
- **リポジトリ削除**: 不要になったリポジトリの削除
- **アクセス権限管理**: リポジトリへのアクセス権限設定

#### 実装ファイル
- `api/repository_handler.go`: リポジトリ管理APIエンドポイント処理
- `repositories/repository_repository.go`: リポジトリ情報の永続化処理
- `models/repository.go`: リポジトリのデータモデル

## 3. APIエンドポイント

管理者ダッシュボード機能のAPIエンドポイントは以下の通りです：

### ユーザー管理
- `GET /api/v1/admin/users`: ユーザー一覧取得
- `PUT /api/v1/admin/users/:id`: ユーザー情報更新

### システム設定管理
- `GET /api/v1/admin/settings`: システム設定取得
- `PUT /api/v1/admin/settings`: システム設定更新

### アクティビティログ管理
- `GET /api/v1/admin/activity-logs`: アクティビティログ一覧取得

### システムメトリクス
- `GET /api/v1/admin/metrics`: システムメトリクス取得

### バックアップ管理
- `POST /api/v1/admin/backups`: バックアップ作成
- `GET /api/v1/admin/backups`: バックアップ一覧取得
- `POST /api/v1/admin/backups/:id/restore`: バックアップからのリストア
- `DELETE /api/v1/admin/backups/:id`: バックアップ削除

### リポジトリ管理
- `GET /api/v1/admin/repositories`: リポジトリ一覧取得
- `GET /api/v1/admin/repositories/:id`: リポジトリ詳細取得
- `POST /api/v1/admin/repositories`: リポジトリ作成
- `PUT /api/v1/admin/repositories/:id`: リポジトリ更新
- `DELETE /api/v1/admin/repositories/:id`: リポジトリ削除

## 4. 管理者権限

システム管理者ダッシュボードへのアクセスは、管理者権限を持つユーザーのみに制限されています。

### 権限管理の実装

- `api/middleware.go`: 管理者権限チェックミドルウェア（AdminMiddleware）
- `models/user.go`: ユーザーモデルの管理者フラグ（IsAdmin）

### 管理者権限の付与方法

1. 既存ユーザーに管理者権限を付与する場合：
   - 管理者ダッシュボードのユーザー管理画面から対象ユーザーの「管理者権限」を有効化

2. 初期管理者ユーザーの設定：
   - システム初期セットアップ時にデータベースに管理者ユーザーが自動登録される
   - または環境変数等で指定された条件に基づいて初回起動時に管理者ユーザーを作成

## 5. セキュリティ対策

管理者ダッシュボードは特権機能のため、セキュリティ対策が重要です。

### 実装されているセキュリティ対策

- **権限チェック**: 各APIエンドポイントでの厳格な管理者権限チェック
- **アクティビティログ**: 管理者操作の詳細なログ記録（監査証跡）
- **セッション管理**: 管理者セッションの適切な管理（タイムアウト、無効化など）
- **入力検証**: すべての入力データの厳格な検証
- **レート制限**: 管理者APIへのアクセス頻度制限（ブルートフォース対策）

### 管理者操作のログ記録

特に重要な管理者操作（ユーザー権限変更、システム設定変更、バックアップ復元など）は、詳細なアクティビティログが記録されます。ログには以下の情報が含まれます：

- 操作実行者（管理者）のID・ユーザー名
- 操作の種類（アクション）
- 操作対象のリソース種別・ID
- 操作日時
- クライアントIPアドレス
- ユーザーエージェント
- 操作の詳細情報

## 6. ダッシュボード画面構成

管理者ダッシュボードは、フロントエンドで以下のような画面構成を持ちます：

### ダッシュボードホーム
- システムの主要メトリクスのサマリー表示
- 最近のアクティビティログ
- 重要なシステム状態通知
- クイックアクションリンク

### ユーザー管理画面
- ユーザー検索・フィルタリング機能
- ユーザー一覧テーブル
- ユーザー詳細・編集フォーム
- 権限管理インターフェース

### システム設定画面
- 一般設定セクション
- メール設定セクション
- 認証設定セクション
- カスタマイズ設定セクション

### アクティビティログ画面
- 高度なフィルタリングオプション
- ログ一覧テーブル
- ログ詳細表示
- エクスポート機能

### メトリクス画面
- ユーザーメトリクスグラフ
- コンテンツメトリクスグラフ
- システムリソースメトリクスグラフ
- パフォーマンスメトリクスグラフ
- 期間選択オプション

### バックアップ管理画面
- バックアップ作成フォーム
- バックアップ一覧テーブル
- リストア操作インターフェース
- 自動バックアップスケジュール設定

### リポジトリ管理画面
- リポジトリ作成フォーム
- リポジトリ一覧テーブル
- リポジトリ詳細・設定画面
- アクセス権限管理インターフェース

## 7. 今後の拡張予定

システム管理者ダッシュボードには、以下のような機能拡張が予定されています：

1. **拡張メトリクスダッシュボード**:
   - より詳細なパフォーマンス指標
   - カスタムダッシュボード設定
   - アラート設定機能

2. **高度なユーザー管理**:
   - バルク操作（一括更新、一括無効化など）
   - ユーザーグループ・ロール管理
   - ユーザーアクティビティ分析

3. **システム健全性モニタリング**:
   - サービス状態監視
   - エラーログ分析
   - 自動異常検知

4. **拡張バックアップ機能**:
   - クラウドストレージ連携
   - 差分バックアップ
   - 部分リストア

5. **監査機能の強化**:
   - 高度な監査レポート
   - コンプライアンスチェック
   - セキュリティ監査
